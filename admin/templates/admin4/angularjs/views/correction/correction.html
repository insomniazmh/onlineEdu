<link href="../../../assets/admin/pages/css/profile.css" rel="stylesheet">
<link href="../../../assets/admin/pages/css/profile-old.css" rel="stylesheet">
<style>
	.class-active {
		box-shadow: #6699FF 0px 0px 10px 5px !important;
	}
	
	.uppercase {
    font-size: 16px;
    margin-top: 10px;
	}
	
	.profile-userpic img {
		width: 80%;
	}
	
	.btn + .btn {
		margin-left: 0;
	}
</style>
<div class="row profile" ng-controller="correctionCtrl">
	<div class="col-md-2">
		<div class="top-news">
			<a href="javascript:;" class="btn {{row.color}} {{row.active ? 'class-active' : ''}}" ng-repeat="row in classes" ng-click="selectClass(row)">
				<span>{{row.className}}</span>
				<em>{{course.courseName}}</em>
				<i class="fa fa-briefcase top-news-icon"></i>
			</a>
		</div>
	</div>
	
	<div class="col-md-10">
		<div class="portlet light">
			<div class="portlet-title tabbable-line">
				<div class="caption font-green-sharp">
					<i class="icon-settings font-green-sharp"></i>
					<span class="caption-subject bold uppercase">待评分学生</span>
				</div>
			</div>
			
			<div class="portlet-body">
				<div class="row">
					<div class="col-md-1" ng-repeat="row in students">
						<div class="uppercase profile-userpic" ng-click="clickStudent(row);">
							<img src="{{row.portrait}}" class="img-responsive" alt="">
						</div>
						<div class="uppercase profile-stat-text">
							{{row.studentName}}
						</div>
					</div>
				</div>
				<div style="clear: both;"></div>
			</div>
		</div>
	</div>
	
	<div class="modal fade" id="correctionModal" role="dialog" aria-hidden="true">
		<div class="modal-dialog modal-full">
			<div class="modal-content">
				<div class="modal-header">
	        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
	        <h4 class="modal-title">回答详情</h4>
	      </div>
	      <div class="modal-body" style="overflow-x: scroll;height: 600px;">
	        <div class="portlet light">
	        	<div style="margin-bottom: 60px;" ng-repeat="item in detail.exerciseAnswerQuestionBooks">
	        		<h3 style="text-align: center;"><span>{{item.chapterName}}</span> </h3>
							<div class="note" style="border-left: 0;border-bottom: 1px solid #eee;" ng-repeat="question in item.bigQuestionExerciseBook.questionChildren">
								
								<div style="width: 48%;float: left;">
									<h4 class="block htmlWrapper" ng-bind-html="question.examChildren[0].title"></h4>
									<div ng-if="question.examChildren[0].examType == 'single' || question.examChildren[0].examType == 'multiple'">
										<p ng-repeat="x in question.examChildren[0].optChildren">
											<span ng-bind-html="x.optValue" style="display: inline-block;"></span>．
											<span ng-bind-html="x.optTxt" style="display: inline-block;"></span>
										</p>
									</div>
								</div>
								<div style="width: 48%;float: left;padding: 10px;height: 100%;  border-left: 1px solid grey;">
									<p>学生回答： {{question.examChildren[0].stuAnswer}}</p>
									<p>正确答案： <span style="display: inline-block;">{{question.examChildren[0].answer}}</span></p>
									<p>解析： <span style="display: inline-block;">{{question.examChildren[0].analysis}}</span></p>
								</div>
								<div style="clear: both;"></div>
							</div>
							<div class="col-md-2 col-md-offset-5">
								<button class="btn btn-block btn-success" ng-click="score()">评分</button>
							</div>
							<div style="clear: both;"></div>
	        	</div>
	        	
						
						
						<!-- <div>
							<h3 style="text-align: center;"><span>第二节：电子商务的实际意义</span> </h3>
							<div class="note" style="border-left: 0;border-bottom: 1px solid #eee;" ng-repeat="question in questions">
								
								<div style="width: 48%;float: left;">
									<h4 class="block htmlWrapper" ng-bind-html="question.title"></h4>
									<div ng-if="question.examChildren[0].examType == 'single' || question.examChildren[0].examType == 'multiple'">
										<p ng-repeat="x in question.examChildren[0].optChildren">
											<span ng-bind-html="x.optValue" style="display: inline-block;"></span>．
											<span ng-bind-html="x.optTxt" style="display: inline-block;"></span>
										</p>
									</div>
								</div>
								<div style="width: 48%;float: left;">
									<p>学生回答： D</p>
									<p>正确答案： <span style="display: inline-block;">{{question.examChildren[0].answer}}</span></p>
									<p>解析： <span style="display: inline-block;">{{question.examChildren[0].analysis}}</span></p>
								</div>
								<div style="clear: both;"></div>
							</div>
							<div class="col-md-2 col-md-offset-5">
								<button class="btn btn-block btn-success" ng-click="score()">评分</button>
							</div>
							<div style="clear: both;"></div>
						</div> -->
						
					</div>
	      </div>
			</div>
			<!-- /.modal-content -->
		</div>
		<!-- /.modal-dialog -->
	</div>
</div>

<script>
	function correctionCtrl($scope, $http) {
		let currClassId = '';
		let classBgColor = ['green','yellow','red','blue'];//班级颜色
		let questions = [{"id":"5cebca0509eb5744b4d2b65a","score":null,"teacherId":"dongbo","paperInfo":null,"examChildren":[{"examType":"single","score":1,"teacherId":"dongbo","choiceQstTxt":"单选-1","choiceQstAnsw":"D","choiceQstAnalysis":"是","title":"单选-1","answer":"D","analysis":"是","choiceType":"single","optChildren":[{"optTxt":"三四十","optValue":"A"},{"optTxt":"休息","optValue":"B"},{"optTxt":"睡醒","optValue":"C"},{"optTxt":"试试","optValue":"D"}]}],"type":null,"chapterId":"40288a826af74248016af8f961540001","relate":0,"levelId":"1","knowledgeId":"","keyword":null,"preview":null,"udate":"2019-05-27 19:29:09"},{"id":"5cebca2d09eb5744b4d2b65b","score":null,"teacherId":"dongbo","paperInfo":null,"examChildren":[{"examType":"multiple","score":1,"teacherId":"dongbo","title":"多选-3","answer":"ABCD","analysis":"是","choiceQstTxt":"多选-3","choiceQstAnsw":"ABCD","choiceQstAnalysis":"是","choiceType":"multiple","optChildren":[{"optTxt":"是","optValue":"A"},{"optTxt":"单独","optValue":"B"},{"optTxt":"热热","optValue":"C"},{"optTxt":"11","optValue":"D"}]}],"type":null,"chapterId":"40288a826af74248016af8f961540001","relate":0,"levelId":"2","knowledgeId":"","keyword":null,"preview":null,"udate":"2019-05-27 19:29:49"},{"id":"5cebca4d09eb5744b4d2b65d","score":null,"teacherId":"dongbo","paperInfo":null,"examChildren":[{"score":1,"examType":"trueOrFalse","teacherId":"dongbo","trueOrFalseInfo":"判断-6","trueOrFalseAnalysis":"444","trueOrFalseAnsw":"N","answer":"N","title":"判断-6","analysis":"444"}],"type":null,"chapterId":"40288a826af74248016af8f961540001","relate":0,"levelId":"2","knowledgeId":"","keyword":null,"preview":null,"udate":"2019-05-27 19:30:21"},{"id":"5cebca6309eb5744b4d2b65f","score":null,"teacherId":"dongbo","paperInfo":null,"examChildren":[{"relate":"1","score":1,"teacherId":"dongbo","examType":"design","designQuestion":"主观-88","designAnsw":"定时达","designAnalysis":"是的","title":"主观-88","answer":"定时达","analysis":"是的"}],"type":null,"chapterId":"40288a826af74248016af8f961540001","relate":0,"levelId":"2","knowledgeId":"","keyword":null,"preview":null,"udate":"2019-05-27 19:30:43"}]
		$scope.questions = common.addTitleForQuestion({
			questionArr: questions
		}); //组装题干以供展示
		
		//获取老师所教班级信息
		$scope.loadClassList = function() {
			common.ajax({
				$scope: $scope,
				$http: $http,
				data: {
					courseId: localStorage.getItem('courseId')
				},
				url: '/teacher/myTeachClass',
				success: function(res) {
					$scope.classes = res.data;
					$scope.classes.forEach(function(value,index){
						if(index == 0) {
							value.active = true;
						}
						value.color = classBgColor[index%4];
					});
					if(res.data.length > 0) {
						currClassId = res.data[0].classId;
						$scope.loadStudentsByClassId();
					}
					
				}
			});
		}
		$scope.loadClassList();
		
		//根据班级id获取班级中待批改学生的信息
		$scope.loadStudentsByClassId = function(stuId) {
			var postData = {
				"classId": currClassId,
			  "courseId": localStorage.getItem('courseId'),
			  "exeBookType": 3,
			  "isAnswerCompleted": "Y",
			  "isReward": "N",
			  "preview": "after"
			};
			
			if(stuId) {
				postData.studentId = stuId;
			}
			common.ajax2({
				$scope: $scope,
				$http: $http,
				data: postData,
				url: '/teacherAnswer/findAnswer',
				success: function(res) {
//					var arr = common.unique(res.data, 'id');
					if(stuId) {
						$scope.detail = res.data[0];
					}else {
						$scope.students = res.data;
					}
					console.log($scope.detail);
				}
			});
		}
		
		//切换课程回调
		$scope.$on('course', function(d, data) {
			$scope.loadClassList();
		});
		
		$scope.selectClass = function(row) {
			$($scope.classes).each(function() {
				this.active = false;
			});
			row.active = true;
			currClassId = row.classId;
			$scope.loadStudentsByClassId();
		}
		
		$scope.clickStudent = function(student) {
			$scope.loadStudentsByClassId(student.studentId);
			$("#correctionModal").modal("show");
		};
		
		$scope.score = function() {
			layer.prompt({title: '请输入评分', value: 5}, function(value, index, elem){
				let reg = /^[0-9]*$/;
				if(!reg.test(value) || value==0) {
					layer.alert("只能输入大于0的数字");
					return false;
				}
				layer.close(index);
				layer.alert('评分成功');
			});
		}
	}
</script>









